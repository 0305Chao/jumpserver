{% extends '_base_list.html' %}
{% load i18n %}
{% load static %}
{% block search_form %}
{% endblock %}

{% block table_container %}
<div class="uc pull-left m-r-5"><a class="btn btn-sm btn-primary btn-create"> {% trans "Create project" %} </a></div>
<table class="table table-striped table-bordered table-hover " id="project_list_table" >
    <thead>
        <tr>
            <th class="text-center">
                <input id="" type="checkbox" class="ipt_check_all">
            </th>
            <th class="text-center">{% trans 'Name' %}</th>
            <th class="text-center">{% trans 'Created by' %}</th>
            <th class="text-center">{% trans 'Date' %}</th>
            <th class="text-center">{% trans 'Action' %}</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
{% endblock %}

{% block custom_foot_js %}
<script>
var table;
function initTable() {
    var options = {
        ele: $('#project_list_table'),
        columnDefs: [
            {targets: 1, createdCell: function (td, cellData, rowData) {
                {% url 'ops:project-detail' pk=DEFAULT_PK as the_url  %}
                var detail_btn = '<a href="{{ the_url }}">' + cellData + '</a>';
                $(td).html(detail_btn.replace('{{ DEFAULT_PK }}', rowData.id));
            }},
            {targets: 4, createdCell: function (td, cellData, rowData) {
                var update_btn = '<a href="{% url "assets:asset-detail" pk=DEFAULT_PK %}" class="btn btn-xs btn-info">{% trans "Update" %}</a>'.replace("{{ DEFAULT_PK }}", cellData);
                var del_btn = '<a class="btn btn-xs btn-danger m-l-xs btn_asset_delete" data-uid="{{ DEFAULT_PK }}">{% trans "Delete" %}</a>'.replace('{{ DEFAULT_PK }}', cellData);
                $(td).html(update_btn + del_btn)
             }}
        ],
        ajax_url: '{% url "api-ops:project-list" %}',

        columns: [
            {data: "id"}, {data: "name" }, {data: "created_by" }, {data: "date_created"}, {data: "id"}
        ]
    };
    table = jumpserver.initDataTable(options);
    return table
}
$(document).ready(function() {
    $('.select2').select2({
        dropdownAutoWidth : true,
        width: 'auto'
    });
    initTable();
}).on('click', '.btn-del', function () {
    var $this = $(this);
    var name = $this.closest("tr").find(":nth-child(2)").children('a').html();
    var uid = $this.data('uid');
    var the_url = '{% url "api-ops:adhoc-task-detail" pk=DEFAULT_PK %}'.replace('{{ DEFAULT_PK }}', uid);
    objectDelete($this, name, the_url);
})
</script>
{% endblock %}

